    .model  tiny, C

    .code
    org 100h
    .186

start:  mov ax,11h  ;640?480?2
    int 10h

;??? ???
    call    line, 200, 450, 1, 0, 240
    call    line, 440, 450, 0, -1, 240
    call    line, 440, 210, -1, 0, 240
    call    line, 200, 210, 0, 1, 240
;?????
    call    line, 200, 210, 1, -1, 120
    call    line, 320, 90, 1, 1, 120
;????
    call    line, 280, 370, 1, 0, 80
    call    line, 360, 370, 0, -1, 80
    call    line, 360, 290, -1, 0, 80
    call    line, 280, 290, 0, 1, 80
;?????? ????
    call    line, 280, 310, 1, 0, 80
    call    line, 320, 310, 0, 1, 60

    mov ah,0    ;???? ????? ???????
    int 16h ;??? ??????

    mov ax,3    ;????????? ????????? ?????
    int 10h 
    
    mov ax, 4c00h
    int 21h 
line    proc    x:word, y:word, deltax:word, deltay:word, count:word
uses    cx, dx, si

    mov si, count
    mov cx, x
    mov dx, y
line_loop:
    call    SetPixel, cx, dx, 1

    add cx, deltax
    add dx, deltay
    dec si  
    jnz line_loop

    ret
line    endp



BytesPerLine    EQU 80      
VideoBufferSeg  EQU 0A000h

PixelAddr   PROC    near
        mov cl,bl       

        push    dx      

        mov dx,BytesPerLine 
        mul dx

        pop dx
        shr bx,1
        shr bx,1
        shr bx,1        
        add bx,ax       

        mov ax,VideoBufferSeg
        mov es,ax       

        and cl,7        
        xor cl,7       
        mov ah,1        
        ret

PixelAddr   ENDP

; Name:     SetPixel
;
; Function: ????????????? ???????? ??????? ? ?????? 640x480
;
;           void SetPixel(x,y,n);
;
;           int x,y;        /* ?????????? ??????? */
;
;           int n;          /* ???? ??????? */

RMWbits     EQU 0       ; read-modify-write bits

SetPixel    PROC    ARGx:word, ARGy:word, ARGn:word
uses        cx, dx, bx, es

        mov ax,ARGy     ; AX := y
        mov bx,ARGx     ; BX := x
        call    PixelAddr   ; AH := ??????? ?????
                    ; ES:BX -> ?????
                    ; CL := ????? ???????

; ????????? ???????? ??????? ????? ???????????? ??????????? (GC)

        shl ah,cl       ; AH := ??????? ????? ? ??????????????? ???????
        mov dx,3CEh     ; ???? ???????? ?????? GC
        mov al,8        ; AL := ????? ???????? ??????? ?????
        out dx,ax

; ????????? ???????? ?????? GC

        mov ax,0005h    ; AL :=  ????? ???????? ??????
                    ; AH :=  ????? ?????? 0 (???? 0,1)
                    ;    ????? ?????? 0 (??? 3)
        out dx,ax

; ????????? ???????? ?????? ????????/???????

        mov ah,RMWbits  ; AH := ???? Read-Modify-Write (=0)
        mov al,3        ; AL := ??????? ?????? Data Rotate/Function
        out dx,ax

; ????????? ????????? ?????????/?????? ? ?????????? ?????????/??????

        mov ah,byte ptr ARGn; AH := ???? ???????
        mov al,0        ; AL := ??????? ?????????/??????
        out dx,ax

        mov ax,0F01h    ; AH := ????????? ??? ???????? ????
                    ; AL := ??????? ?????????? ?????????/??????
        out dx,ax

; ????????? ???????? ???????

        or  es:[bx],al  ; ???????? ? ??????? ?? ????? ??????
                    ; ? ????????? ?? ????? ??????

; ??????????? ???????? ??-?????????

        mov ax,0FF08h   ; ????? ?????
        out dx,ax

        mov ax,0005     ; ??????? ??????
        out dx,ax

        mov ax,0003     ; ????? ???????
        out dx,ax

        mov ax,0001     ; ?????????? ?????????/??????
        out dx,ax

        ret
SetPixel    ENDP

    end start